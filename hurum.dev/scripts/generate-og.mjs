import sharp from 'sharp';
import { fileURLToPath } from 'url';
import { dirname, join } from 'path';

const __dirname = dirname(fileURLToPath(import.meta.url));
const outPath = join(__dirname, '..', 'public', 'og-image.png');

const WIDTH = 1200;
const HEIGHT = 630;

const svg = `<svg width="${WIDTH}" height="${HEIGHT}" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <radialGradient id="glow" cx="0.32" cy="0.50" r="0.30" gradientUnits="objectBoundingBox">
      <stop offset="0%" stop-color="#2B98FF" stop-opacity="0.16"/>
      <stop offset="55%" stop-color="#2B98FF" stop-opacity="0.05"/>
      <stop offset="100%" stop-color="#2B98FF" stop-opacity="0"/>
    </radialGradient>
    <radialGradient id="ambient" cx="0.65" cy="0.25" r="0.45" gradientUnits="objectBoundingBox">
      <stop offset="0%" stop-color="#2B98FF" stop-opacity="0.03"/>
      <stop offset="100%" stop-color="#2B98FF" stop-opacity="0"/>
    </radialGradient>
  </defs>

  <!-- Background -->
  <rect width="${WIDTH}" height="${HEIGHT}" fill="#0c0d14"/>
  <rect width="${WIDTH}" height="${HEIGHT}" fill="url(#glow)"/>
  <rect width="${WIDTH}" height="${HEIGHT}" fill="url(#ambient)"/>

  <!-- Icon (viewBox 90 90 520 520 → 300x300 at 110,165) -->
  <g transform="translate(110,165) scale(0.5769) translate(-90,-90)">
    <path d="M365.705 590.91C355.997 592.086 343.292 591.641 333.585 591.111C278.773 588.023 226.476 567.097 184.672 531.52C142.641 496.265 108.539 441.505 103.77 386.006C100.125 338.562 115.232 291.579 145.85 255.146C175.042 220.959 216.61 199.747 261.429 196.168C318.814 191.501 379.458 216.585 396.807 275.141C400.122 286.332 400.939 294.716 401.865 306.394C380.994 275.116 349.203 257.549 311.492 259.691C253.762 268.073 233.346 324.507 240.937 376.486C248.315 424.093 274.332 466.811 313.25 495.22C353.249 524.875 403.322 537.575 452.626 530.571C498.043 523.817 530.748 503.527 563.508 472.555C528.012 529.232 471.645 569.674 406.57 585.147C394.15 588.059 378.642 590.125 365.705 590.91Z" fill="#2B98FF"/>
    <path d="M365.705 590.91C361.963 588.303 348.478 587.548 343.116 586.591C237.391 567.737 154.406 456.94 187.544 350.23C203.003 300.452 247.298 263.152 299.618 259.134C303.002 258.878 308.397 258.506 311.673 259.053L311.492 259.691C253.762 268.073 233.346 324.507 240.937 376.486C248.316 424.093 274.332 466.811 313.25 495.22C353.249 524.875 403.322 537.575 452.626 530.571C498.043 523.817 530.748 503.527 563.508 472.555C528.012 529.232 471.645 569.674 406.57 585.147C394.151 588.059 378.642 590.125 365.705 590.91Z" fill="white"/>
    <path d="M330.955 100.554C386.083 96.3467 437.782 116.454 481.029 149.099C564.757 212.306 540.23 347.855 430.591 360.284C443.918 326.963 447.032 294.539 435.174 260.22C422.432 223.366 395.406 195.304 360.714 178.299C358.24 177.108 355.736 175.978 353.207 174.91C309.713 156.508 262.081 158.373 218.664 176.087C176.337 193.638 140.818 224.396 117.403 263.774C110.897 274.741 104.966 287.99 100 299.772C107.419 256.754 126.787 216.688 155.892 184.148C201.703 132.482 262.426 104.586 330.955 100.554Z" fill="#2B98FF"/>
    <path d="M591.479 308.062L592.381 305.422L592.972 305.421C594.873 309.17 596.652 326.094 596.896 330.694C597.524 335.118 597.304 341.005 597.243 345.513C596.451 409.181 555.611 464.781 496.745 488.564C457.495 504.461 413.529 504.078 374.559 487.498C334.907 470.942 303.548 439.182 287.505 399.328C277.343 373.852 265.729 323.176 299.33 310.13C304.335 325.015 307.629 334.071 315.581 347.666C336.059 382.907 369.721 408.553 409.141 418.943C447.325 428.927 485.886 422.722 519.804 402.871C555.306 382.001 581.089 347.906 591.479 308.062Z" fill="#2B98FF"/>
  </g>

  <!-- Wordmark (viewBox 719 170 1822 352 → 466x90 at 475,230) -->
  <g transform="translate(475,230) scale(0.2557) translate(-719,-170)">
    <g transform="translate(0, -691.654)">
      <path d="M2138.51 1206.45V863.816H2286.56L2332.62 1053.7L2337.32 1078.61H2341.55L2346.25 1053.7L2395.13 863.816H2539.89V1206.45H2452V980.376L2452.47 943.716H2448.71L2439.78 983.666L2383.38 1206.45H2295.49L2238.15 981.316L2230.16 943.716H2225.93L2226.4 980.376V1206.45H2138.51Z" fill="white"/>
      <path d="M1937.84 1211.15C1914.34 1211.15 1892.88 1208.33 1873.45 1202.69C1854.34 1196.73 1837.89 1188.12 1824.1 1176.84C1810.63 1165.56 1800.13 1151.61 1792.61 1135.01C1785.09 1118.4 1781.33 1099.29 1781.33 1077.67V863.816H1874.39V1084.25C1874.39 1095.21 1876.74 1104.77 1881.44 1112.92C1886.14 1121.06 1893.19 1127.33 1902.59 1131.72C1911.99 1136.1 1923.74 1138.3 1937.84 1138.3C1952.26 1138.3 1964.01 1136.1 1973.09 1131.72C1982.49 1127.33 1989.54 1121.06 1994.24 1112.92C1998.94 1104.77 2001.29 1095.21 2001.29 1084.25V863.816H2094.35V1077.67C2094.35 1106.49 2087.77 1130.78 2074.61 1150.52C2061.77 1170.26 2043.59 1185.3 2020.09 1195.64C1996.59 1205.98 1969.18 1211.15 1937.84 1211.15Z" fill="white"/>
      <path d="M1440.39 1206.45V863.816H1623.69C1649.7 863.816 1671.48 868.359 1689.02 877.446C1706.57 886.219 1719.57 898.752 1728.03 915.046C1736.81 931.026 1741.19 949.669 1741.19 970.976C1741.19 988.522 1737.9 1004.03 1731.32 1017.51C1725.06 1030.98 1716.13 1042.1 1704.53 1050.88C1692.94 1059.34 1679.15 1065.29 1663.17 1068.74L1660.82 1068.27L1662.7 1061.69L1754.82 1206.45H1643.43L1571.52 1086.13H1525.93V1016.1H1604.42C1616.64 1016.1 1625.89 1013.12 1632.15 1007.17C1638.73 1001.21 1642.02 992.909 1642.02 982.256V968.156C1642.02 957.502 1638.73 949.356 1632.15 943.716C1625.57 937.762 1616.33 934.786 1604.42 934.786H1533.45V1206.45H1440.39Z" fill="white"/>
      <path d="M1239.73 1211.15C1216.23 1211.15 1194.76 1208.33 1175.34 1202.69C1156.22 1196.73 1139.77 1188.12 1125.99 1176.84C1112.51 1165.56 1102.02 1151.61 1094.5 1135.01C1086.98 1118.4 1083.22 1099.29 1083.22 1077.67V863.816H1176.28V1084.25C1176.28 1095.21 1178.63 1104.77 1183.33 1112.92C1188.03 1121.06 1195.08 1127.33 1204.48 1131.72C1213.88 1136.1 1225.63 1138.3 1239.73 1138.3C1254.14 1138.3 1265.89 1136.1 1274.98 1131.72C1284.38 1127.33 1291.43 1121.06 1296.13 1112.92C1300.83 1104.77 1303.18 1095.21 1303.18 1084.25V863.816H1396.24V1077.67C1396.24 1106.49 1389.66 1130.78 1376.5 1150.52C1363.65 1170.26 1345.48 1185.3 1321.98 1195.64C1298.48 1205.98 1271.06 1211.15 1239.73 1211.15Z" fill="white"/>
      <path d="M719.33 1206.45V863.816H812.39V1206.45H719.33ZM946.81 1206.45V863.816H1039.4V1206.45H946.81ZM804.87 1069.21V995.886H954.33V1069.21H804.87Z" fill="white"/>
    </g>
  </g>

  <!-- Tagline -->
  <text x="480" y="360" fill="#6b7280" font-family="-apple-system, BlinkMacSystemFont, system-ui, sans-serif" font-size="22" font-weight="300" letter-spacing="0.2">Predictable state machines for TypeScript applications</text>
</svg>`;

const buf = Buffer.from(svg);

sharp(buf)
  .png()
  .toFile(outPath)
  .then(info => {
    console.log('Generated:', outPath);
    console.log('Size:', info.width, 'x', info.height, `(${(info.size / 1024).toFixed(1)} KB)`);
  })
  .catch(err => {
    console.error('Error:', err);
    process.exit(1);
  });
